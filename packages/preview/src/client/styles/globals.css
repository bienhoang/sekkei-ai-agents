@import "tailwindcss";
@import "./notion-blocks.css";
@plugin "@tailwindcss/typography";

@theme {
  --font-sans: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', ui-monospace, monospace;
  --leading-relaxed: 1.8;
}

/* ── Theme CSS Variables ── */
:root {
  --c-bg: #09090b;
  --c-bg-soft: #18181b;
  --c-bg-mute: #27272a;
  --c-bg-alt: rgba(39, 42, 55, 0.5);
  --c-divider: rgba(39, 42, 55, 0.6);
  --c-divider-light: rgba(63, 63, 70, 0.5);
  --c-text-1: #f4f4f5;
  --c-text-2: #a1a1aa;
  --c-text-3: #71717a;
  --c-text-4: #52525b;
  --c-brand: #818cf8;
  --c-brand-soft: rgba(79, 70, 229, 0.2);
}

[data-theme="light"] {
  --c-bg: #ffffff;
  --c-bg-soft: #f9fafb;
  --c-bg-mute: #f3f4f6;
  --c-bg-alt: rgba(243, 244, 246, 0.8);
  --c-divider: #e5e7eb;
  --c-divider-light: #e5e7eb;
  --c-text-1: #111827;
  --c-text-2: #4b5563;
  --c-text-3: #6b7280;
  --c-text-4: #9ca3af;
  --c-brand: #4f46e5;
  --c-brand-soft: rgba(79, 70, 229, 0.1);
}

/* ── Scrollbar ── */
* {
  scrollbar-width: thin;
  scrollbar-color: theme(colors.zinc.700) transparent;
}

[data-theme="light"] * {
  scrollbar-color: #d1d5db transparent;
}

/* ── Prose overrides for JP documents ── */
.prose { line-height: var(--leading-relaxed); }

/* Dark mode prose (default) */
.prose {
  --tw-prose-body: #d4d4d8;
  --tw-prose-headings: #f4f4f5;
  --tw-prose-lead: #a1a1aa;
  --tw-prose-links: #818cf8;
  --tw-prose-bold: #f4f4f5;
  --tw-prose-counters: #a1a1aa;
  --tw-prose-bullets: #71717a;
  --tw-prose-hr: #3f3f46;
  --tw-prose-quotes: #d4d4d8;
  --tw-prose-quote-borders: #3f3f46;
  --tw-prose-captions: #a1a1aa;
  --tw-prose-kbd: #f4f4f5;
  --tw-prose-code: #f4f4f5;
  --tw-prose-pre-code: #d4d4d8;
  --tw-prose-pre-bg: #18181b;
  --tw-prose-th-borders: #3f3f46;
  --tw-prose-td-borders: #27272a;
}

/* Light mode prose */
[data-theme="light"] .prose {
  --tw-prose-body: #374151;
  --tw-prose-headings: #111827;
  --tw-prose-lead: #6b7280;
  --tw-prose-links: #4f46e5;
  --tw-prose-bold: #111827;
  --tw-prose-counters: #6b7280;
  --tw-prose-bullets: #9ca3af;
  --tw-prose-hr: #e5e7eb;
  --tw-prose-quotes: #374151;
  --tw-prose-quote-borders: #d1d5db;
  --tw-prose-captions: #6b7280;
  --tw-prose-kbd: #111827;
  --tw-prose-code: #111827;
  --tw-prose-pre-code: #d4d4d8;
  --tw-prose-pre-bg: #1e1e2e;
  --tw-prose-th-borders: #d1d5db;
  --tw-prose-td-borders: #e5e7eb;
}

/* ── Tiptap core ── */
.ProseMirror { outline: none; }
.ProseMirror p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  color: var(--c-text-4);
  pointer-events: none;
  float: left;
  height: 0;
}

/* ── Table styling ── */
.ProseMirror table.tiptap-table,
.ProseMirror table {
  border-collapse: collapse;
  width: 100%;
  margin: 1rem 0;
  font-size: 0.875rem;
}

.ProseMirror table th,
.ProseMirror table td {
  border: 1px solid theme(colors.zinc.700);
  padding: 0.5rem 0.75rem;
  text-align: left;
  vertical-align: top;
}

.ProseMirror table th {
  background: theme(colors.zinc.800);
  font-weight: 600;
  color: theme(colors.zinc.200);
  font-size: 0.8rem;
  text-transform: none;
}

.ProseMirror table td {
  background: theme(colors.zinc.900);
  color: theme(colors.zinc.300);
}

.ProseMirror table tr:hover td {
  background: theme(colors.zinc.800/50);
}

.ProseMirror table .selectedCell {
  background: theme(colors.indigo.900/30);
  border-color: theme(colors.indigo.500/50);
}

/* Light mode tables */
[data-theme="light"] .ProseMirror table th,
[data-theme="light"] .ProseMirror table td {
  border-color: #e5e7eb;
}

[data-theme="light"] .ProseMirror table th {
  background: #f9fafb;
  color: #111827;
}

[data-theme="light"] .ProseMirror table td {
  background: #ffffff;
  color: #374151;
}

[data-theme="light"] .ProseMirror table tr:hover td {
  background: #f3f4f6;
}

[data-theme="light"] .ProseMirror table .selectedCell {
  background: rgba(79, 70, 229, 0.1);
  border-color: rgba(79, 70, 229, 0.3);
}

/* ── Code block styling ── */
.code-block {
  background: #1a1b26;
  border: 1px solid theme(colors.zinc.800);
  padding: 1rem 1.25rem;
  position: relative;
  font-family: var(--font-mono);
}

.code-block code {
  font-family: inherit;
  font-size: 0.8125rem;
  line-height: 1.7;
}

.code-lang-badge {
  position: absolute;
  top: 0.375rem;
  right: 0.5rem;
  font-size: 0.625rem;
  color: theme(colors.zinc.500);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  pointer-events: none;
  font-family: var(--font-mono);
}

[data-theme="light"] .code-block {
  background: #f8fafc;
  border-color: #e2e8f0;
}

[data-theme="light"] .code-lang-badge {
  color: #94a3b8;
}

/* ── Syntax highlighting (lowlight / hljs classes) — Dark ── */
.hljs-comment,
.hljs-quote { color: #636da6; font-style: italic; }

.hljs-keyword,
.hljs-selector-tag,
.hljs-type { color: #bb9af7; }

.hljs-string,
.hljs-attr,
.hljs-addition { color: #9ece6a; }

.hljs-number,
.hljs-literal { color: #ff9e64; }

.hljs-built_in,
.hljs-builtin-name { color: #7dcfff; }

.hljs-function .hljs-title,
.hljs-title.function_ { color: #7aa2f7; }

.hljs-variable,
.hljs-template-variable { color: #c0caf5; }

.hljs-name,
.hljs-tag { color: #f7768e; }

.hljs-attribute { color: #bb9af7; }

.hljs-regexp { color: #b4f9f8; }

.hljs-symbol,
.hljs-bullet { color: #73daca; }

.hljs-meta { color: #636da6; }

.hljs-deletion { color: #f7768e; }

.hljs-section,
.hljs-title { color: #7aa2f7; font-weight: 600; }

.hljs-emphasis { font-style: italic; }
.hljs-strong { font-weight: 700; }

/* ── Syntax highlighting — Light ── */
[data-theme="light"] .hljs-comment,
[data-theme="light"] .hljs-quote { color: #6a737d; }

[data-theme="light"] .hljs-keyword,
[data-theme="light"] .hljs-selector-tag,
[data-theme="light"] .hljs-type { color: #d73a49; }

[data-theme="light"] .hljs-string,
[data-theme="light"] .hljs-attr,
[data-theme="light"] .hljs-addition { color: #22863a; }

[data-theme="light"] .hljs-number,
[data-theme="light"] .hljs-literal { color: #005cc5; }

[data-theme="light"] .hljs-built_in,
[data-theme="light"] .hljs-builtin-name { color: #005cc5; }

[data-theme="light"] .hljs-function .hljs-title,
[data-theme="light"] .hljs-title.function_ { color: #6f42c1; }

[data-theme="light"] .hljs-variable,
[data-theme="light"] .hljs-template-variable { color: #24292e; }

[data-theme="light"] .hljs-name,
[data-theme="light"] .hljs-tag { color: #22863a; }

[data-theme="light"] .hljs-attribute { color: #6f42c1; }

[data-theme="light"] .hljs-regexp { color: #032f62; }

[data-theme="light"] .hljs-symbol,
[data-theme="light"] .hljs-bullet { color: #005cc5; }

[data-theme="light"] .hljs-meta { color: #6a737d; }

[data-theme="light"] .hljs-deletion { color: #d73a49; }

[data-theme="light"] .hljs-section,
[data-theme="light"] .hljs-title { color: #005cc5; }

/* ── Task list (checkboxes) ── */
.ProseMirror ul[data-type="taskList"] {
  list-style: none;
  padding-left: 0;
}

.ProseMirror ul[data-type="taskList"] li {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin: 0.25rem 0;
}

.ProseMirror ul[data-type="taskList"] li > label {
  flex-shrink: 0;
  margin-top: 0.25rem;
}

.ProseMirror ul[data-type="taskList"] li > label input[type="checkbox"] {
  appearance: none;
  width: 1rem;
  height: 1rem;
  border: 2px solid theme(colors.zinc.600);
  border-radius: 0.25rem;
  background: transparent;
  cursor: pointer;
  transition: all 0.15s;
}

[data-theme="light"] .ProseMirror ul[data-type="taskList"] li > label input[type="checkbox"] {
  border-color: #d1d5db;
}

.ProseMirror ul[data-type="taskList"] li > label input[type="checkbox"]:checked {
  background: theme(colors.indigo.600);
  border-color: theme(colors.indigo.600);
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3E%3C/svg%3E");
}

.ProseMirror ul[data-type="taskList"] li[data-checked="true"] > div > p {
  text-decoration: line-through;
  color: theme(colors.zinc.500);
}

[data-theme="light"] .ProseMirror ul[data-type="taskList"] li[data-checked="true"] > div > p {
  color: #9ca3af;
}

/* ── Highlight ── */
.ProseMirror mark {
  background: theme(colors.yellow.500/30);
  color: theme(colors.yellow.200);
  padding: 0.1em 0.2em;
  border-radius: 0.15em;
}

[data-theme="light"] .ProseMirror mark {
  background: rgba(234, 179, 8, 0.3);
  color: #92400e;
}

/* ── Subscript / Superscript ── */
.ProseMirror sub { font-size: 0.75em; }
.ProseMirror sup { font-size: 0.75em; }

/* ── Images ── */
.ProseMirror img {
  max-width: 100%;
  height: auto;
  border-radius: 0.5rem;
  border: 1px solid theme(colors.zinc.700/50);
}

[data-theme="light"] .ProseMirror img {
  border-color: #e5e7eb;
}

/* ── Mermaid ── */
.mermaid-wrapper {
  margin: 1rem 0;
}

.mermaid-diagram svg {
  max-width: 100%;
  height: auto;
}

/* ── Screen reader only (for hidden mermaid source) ── */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
